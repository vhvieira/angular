import { __decorate, __metadata, __extends, __spread } from 'tslib';
import { Component, ViewChild, Input, Output, forwardRef, EventEmitter, ChangeDetectionStrategy, Inject, Injectable, NgModule } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import * as momentNS from 'moment';
import { TranslateService, TranslateModule } from '@ngx-translate/core';
import { Logger, MessageService, LocaleService, trackByIndex, MastercardCommons } from '@mastercard/ng-commons';
import { tap } from 'rxjs/operators/tap';
import { ModalDirective, AccordionModule, AlertModule, ButtonsModule, CarouselModule, CollapseModule, ModalModule, BsDropdownModule, PaginationModule, ProgressbarModule, RatingModule, SortableModule, TabsModule, TimepickerModule, TooltipModule, TypeaheadModule, PopoverModule } from 'ngx-bootstrap';
import { Subject } from 'rxjs/Subject';
import { ToastrService, ToastrModule } from 'ngx-toastr';
import { deserialize, deserializeAs, Serialize, Deserialize } from 'cerialize';
import { Http, Response, Headers, RequestOptions, XSRFStrategy, CookieXSRFStrategy } from '@angular/http';
import { isEqual, pickBy } from 'lodash';
import { _throw } from 'rxjs/observable/throw';
import { of } from 'rxjs/observable/of';
import { mergeMap, tap as tap$1, catchError, shareReplay, map, mergeMapTo, finalize, filter, publishReplay, refCount } from 'rxjs/operators';
import { filter as filter$1 } from 'rxjs/operators/filter';
import { map as map$1 } from 'rxjs/operators/map';
import { CommonModule } from '@angular/common';

var moment = momentNS;
var DatePickerComponent = /** @class */ (function () {
    function DatePickerComponent(translateService, logger) {
        var _this = this;
        this.translateService = translateService;
        this.logger = logger;
        this.format = 'MMM D, Y';
        this.additionalFormats = ['M/D/YYYY'];
        this.allowInvalid = false;
        this.allowEdit = true;
        this.customClassNames = '';
        this.changed = new EventEmitter();
        this.open = false;
        this.openTimepicker = false;
        this.disabled = false;
        this.propagateChange = function (_) {
        };
        this.writeValue = function (v) {
            if (v) {
                if (v === _this.componentValue) {
                    return;
                }
                else if (v && v instanceof Date) {
                    var d = moment(v);
                    _this.milliseconds = d.millisecond();
                    _this.seconds = d.second();
                    _this.minutes = d.minute();
                    _this.hours = d.hour();
                    _this._updateValue(v);
                }
            }
            else {
                _this._updateValue(null);
            }
        };
        this.x = this.y = this.z = 0;
        this.open = false;
        this.lang = this.lang || this.translateService.currentLang;
        moment.locale('en-US');
        if (this.lang === 'en-US') {
            moment.locale(this.lang);
        }
        else if (this.lang === 'pt-BR') {
            moment.locale(this.lang);
        }
        else if (this.lang === 'es-CO') {
            moment.locale(this.lang);
        }
        else {
            try {
                moment.locale(this.lang);
            }
            catch (e) {
                this.logger.error('Locale ERROR: Locale not recognized.');
            }
        }
        this.datepickerClasses = this.getClasses();
        this.rowCounts = this.rowCount();
        this.daysOfWeek = {
            'en-US': ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
            'es-CO': ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
            'pt-BR': ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb']
        };
        this.monthOfYear = {
            'en-US': [
                'January',
                'February',
                'March',
                'April',
                'May',
                'June',
                'July',
                'August',
                'September',
                'October',
                'November',
                'December'
            ],
            'es-CO': ['Enero',
                'Febrero',
                'Marzo',
                'Abril',
                'Mayo',
                'Junio',
                'Julio',
                'Agosto',
                'Septiembre',
                'Octubre',
                'Noviembre',
                'Diciembre'],
            'pt-BR': ['Janeiro',
                'Fevereiro',
                'Março',
                'Abril',
                'Maio',
                'Junho',
                'Julho',
                'Agosto',
                'Setembro',
                'Outubro',
                'Novembro',
                'Dezembro']
        };
    }
    DatePickerComponent.prototype.ngOnInit = function () {
        this.display = '';
        this.displayValue = moment().format(this.format);
    };
    DatePickerComponent.prototype.getInputClasses = function () {
        var classes = [];
        classes.push(this.customClassNames);
        if (this.open) {
            classes.push('date-picker-popup-open');
        }
        return classes.join(' ');
    };
    DatePickerComponent.prototype.getClasses = function () {
        var classes = {
            'datepicker datepicker-dropdown': true,
            'dropdown-menu': true
        };
        switch (this.orient) {
            case 'bottom-left':
            default:
                classes['datepicker-orient-left'] = true;
                classes['datepicker-orient-bottom'] = true;
                break;
            case 'bottom-right':
                classes['datepicker-orient-right'] = true;
                classes['datepicker-orient-bottom'] = true;
                break;
            case 'top-left':
                classes['datepicker-orient-left'] = true;
                classes['datepicker-orient-top'] = true;
                break;
            case 'top-right':
                classes['datepicker-orient-right'] = true;
                classes['datepicker-orient-top'] = true;
                break;
        }
        return classes;
    };
    DatePickerComponent.prototype.onClick = function ($event) {
        if (!this.open) {
            var el = $event.srcElement || $event.target;
            switch (this.orient) {
                case 'bottom-left':
                default:
                    this.x = el.offsetLeft;
                    this.y = el.offsetTop + el.offsetHeight + 4;
                    break;
                case 'bottom-right':
                    this.x = el.offsetLeft + el.offsetWidth - 10;
                    this.y = el.offsetTop + el.offsetHeight + 4;
                    break;
                case 'top-left':
                    this.x = el.offsetLeft;
                    this.y = el.offsetTop - 4;
                    break;
                case 'top-right':
                    this.x = el.offsetLeft + el.offsetWidth - 10;
                    this.y = el.offsetTop - 4;
                    break;
            }
            this.x = this.x + "px";
            this.y = this.y + "px";
            this.z = 10;
            this.display = 'block';
            this.open = true;
            this.calDate = moment(this.curDate);
            el.blur();
        }
    };
    DatePickerComponent.prototype.eatClick = function ($event) {
        $event.stopPropagation();
    };
    DatePickerComponent.prototype.onDeClick = function ($event) {
        if ($event && ($event.target === this.input.nativeElement)) {
            return;
        }
        if (this.open) {
            this.x = 0;
            this.y = 0;
            this.z = 0;
            this.display = 'none';
            this.open = false;
        }
    };
    DatePickerComponent.prototype.onDayClick = function (dt) {
        if (!dt.classes.disabled) {
            this._updateValue(dt.date);
            this.onDeClick(null);
        }
        this.openTimepicker = true;
    };
    DatePickerComponent.prototype.onInputChange = function ($event) {
        var value = moment($event.target.value, [this.format].concat(this.additionalFormats), true);
        if (this._validate(value)) {
            this._updateValue(value.toDate());
        }
        else {
            this._updateValue(null);
        }
    };
    DatePickerComponent.prototype.displayMonth = function () {
        this._calDate();
        return this.monthOfYear[this.lang][this.calDate.month()] + " " + this.calDate.year();
    };
    DatePickerComponent.prototype.rowCount = function () {
        var first;
        var last;
        var rows = [];
        this._calDate();
        first = this._first(this.calDate);
        first.startOf('week');
        last = moment(this.calDate);
        last.endOf('month').endOf('week');
        for (var i = 0; i <= last.diff(first, 'weeks'); i++) {
            rows.push(i);
        }
        return rows;
    };
    DatePickerComponent.prototype.calendarRow = function (row) {
        var first;
        var last;
        var start;
        var highlight;
        var today = moment().startOf('day');
        var cols = [];
        first = this._first(this.calDate);
        last = this._last(this.calDate);
        start = this._start(first, row);
        highlight = this.curDate && moment(this.curDate).startOf('day');
        for (var i = 0; i < 7; i++) {
            cols.push({
                value: start.date(),
                date: start.toDate(),
                classes: {
                    day: true,
                    old: start.diff(first, 'days') < 0,
                    new: start.diff(last, 'days') > 0,
                    highlighted: 0 === start.diff(highlight, 'days'),
                    today: 0 === start.diff(today, 'days'),
                    active: 0 === start.diff(highlight, 'days'),
                    disabled: this._disabled(start.toDate())
                }
            });
            start.add(1, 'days');
        }
        return cols;
    };
    DatePickerComponent.prototype.registerOnChange = function (cb) {
        this.propagateChange = cb;
    };
    DatePickerComponent.prototype.registerOnTouched = function (cb) {
        this.onTouched = cb;
    };
    DatePickerComponent.prototype.setDisabledState = function (disabled) {
        if (disabled) {
            this.onDeClick(null);
        }
        this.disabled = disabled;
    };
    DatePickerComponent.prototype._updateValue = function (v) {
        this.componentValue = this._normalizeTime(v);
        this.curDate = this.componentValue && moment(this.componentValue);
        this._formatDisplay();
        this.changed.emit(this.componentValue || '');
        this.propagateChange(this.componentValue || '');
    };
    DatePickerComponent.prototype._formatDisplay = function () {
        var v;
        if (this.curDate && this.curDate.isValid()) {
            v = this.curDate.format(this.format);
        }
        else if (this.allowInvalid) {
            v = this.input.nativeElement.value;
        }
        else {
            v = '';
        }
        if (v === this.displayValue) {
            this.input.nativeElement.value = v;
        }
        else {
            this.displayValue = v;
        }
    };
    DatePickerComponent.prototype._first = function (date) {
        return moment(date).startOf('month').startOf('day');
    };
    DatePickerComponent.prototype._last = function (date) {
        return moment(date).endOf('month').startOf('day');
    };
    DatePickerComponent.prototype._start = function (date, row) {
        return moment(date).startOf('week').startOf('day').add(7 * row, 'days');
    };
    DatePickerComponent.prototype._validate = function (date) {
        if (this.allowInvalid) {
            return true;
        }
        else if (date.isValid()) {
            if (!this.min || date.toDate() >= this.min) {
                if (!this.max || date.toDate() <= this.max) {
                    return true;
                }
            }
        }
        return false;
    };
    DatePickerComponent.prototype._disabled = function (dt) {
        var d = this._normalizeTime(dt);
        if (this.min && d < this.min) {
            return true;
        }
        else if (this.max && d > this.max) {
            return true;
        }
        return false;
    };
    DatePickerComponent.prototype._normalizeTime = function (dt) {
        var d;
        if (!dt) {
            return dt;
        }
        d = moment(dt);
        d.millisecond(this.milliseconds);
        d.second(this.seconds);
        d.minute(this.minutes);
        d.hour(this.hours);
        return d.toDate();
    };
    DatePickerComponent.prototype._calDate = function () {
        this.calDate = moment(this.calDate || this.curDate);
        if (!this.calDate.isValid()) {
            this.calDate = moment();
        }
    };
    DatePickerComponent.prototype.trackByFn = function (i) {
        return i;
    };
    return DatePickerComponent;
}());
DatePickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'fc-date-picker',
                template: "<input #input id=\"date-picker-input\" type=\"text\" [value]=\"displayValue\" class=\"form-control input-standard icon-calendar \"  [ngClass]=\"getInputClasses()\"\n\t   (click)=\"onClick ($event)\" (window:click)=\"onDeClick ($event)\" (change)=\"onInputChange ($event)\" (blur)=\"onTouched()\"\n\t   [disabled]=\"disabled\" [readonly]=\"!allowEdit\">\n<div [ngClass]=\"datepickerClasses\" [style.top]=\"y\" [style.left]=\"x\" [style.z-index]=\"z\" [style.display]=\"display\" (click)=\"eatClick ($event)\">\n\t<div class=\"datepicker-days\">\n\t\t<table class=\"table-condensed\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th colspan=\"7\" class=\"datepicker-title\" [style.display]=\"title ? 'table-cell' : 'none'\">{{ title }}</th>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<th class=\"prevYear\" (click)=\"calDate.subtract (1, 'year')\"><i class=\"fa fa-angle-double-left color-orange\" aria-hidden=\"true\"></i></th>\n\t\t\t\t\t<th class=\"prev\" (click)=\"calDate.subtract (1, 'month')\"><i class=\"fa fa-angle-left color-orange\" aria-hidden=\"true\"></i></th>\n\t\t\t\t\t<th colspan=\"3\" class=\"datepicker-switch\">{{ displayMonth () }}</th>\n\t\t\t\t\t<th class=\"next\" (click)=\"calDate.add (1, 'month')\"><i class=\"fa fa-angle-right color-orange\" aria-hidden=\"true\"></i></th>\n\t\t\t\t\t<th class=\"nextYear\" (click)=\"calDate.add (1, 'year')\"><i class=\"fa fa-angle-double-right color-orange\" aria-hidden=\"true\"></i></th>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<th *ngFor=\"let day of daysOfWeek[lang]; trackBy: trackByFn\" class=\"dow\">{{ day }}</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t<tr *ngFor=\"let row of rowCount(); trackBy: trackByFn\">\n\t\t\t\t\t<td *ngFor=\"let day of calendarRow(row); trackBy: trackByFn\" [ngClass]=\"day.classes\" (click)=\"onDayClick (day)\">{{ day.value }}</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n</div>\n",
                styles: [".icon-calendar{\n  background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOC4xLjEsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjI1LjNweCINCgkgaGVpZ2h0PSIyNC45cHgiIHZpZXdCb3g9IjAgMCAyNS4zIDI0LjkiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI1LjMgMjQuOSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8ZyBpZD0iY2FsIj4NCgk8Zz4NCgkJPHBhdGggZmlsbD0iI0NDQ0NDQyIgZD0iTTIwLjksNGgxLjhjMC41LDAsMC45LDAuMiwxLjMsMC41YzAuNCwwLjMsMC41LDAuNywwLjUsMS4ydjE3YzAsMC41LTAuMiwwLjktMC41LDEuMg0KCQkJYy0wLjQsMC4zLTAuOCwwLjUtMS4zLDAuNUgyLjVjLTAuNSwwLTAuOS0wLjItMS4zLTAuNWMtMC40LTAuMy0wLjUtMC43LTAuNS0xLjJ2LTE3YzAtMC41LDAuMi0wLjksMC41LTEuMkMxLjUsNC4yLDIsNCwyLjUsNGgxLjgNCgkJCSBNMi41LDIyLjhoMjAuM1Y5LjFIMi41VjIyLjh6Ii8+DQoJCTxyZWN0IHg9IjYiIHk9IjExIiBmaWxsPSIjQ0NDQ0NDIiB3aWR0aD0iMi41IiBoZWlnaHQ9IjIuNSIvPg0KCQk8cmVjdCB4PSIxNS4zIiB5PSIwLjUiIGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIzLjgiIGhlaWdodD0iNS45Ii8+DQoJCTxyZWN0IHg9IjYuMSIgeT0iMC41IiBmaWxsPSIjQ0NDQ0NDIiB3aWR0aD0iMy44IiBoZWlnaHQ9IjUuOSIvPg0KCQk8cmVjdCB4PSIxMS4xIiB5PSIxMSIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjIuNSIgaGVpZ2h0PSIyLjUiLz4NCgkJPHJlY3QgeD0iMTYuMyIgeT0iMTEiIGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIyLjUiIGhlaWdodD0iMi41Ii8+DQoJPC9nPg0KPC9nPg0KPGcgaWQ9ImNhbC1vdmVyIiBkaXNwbGF5PSJub25lIj4NCgk8ZyBkaXNwbGF5PSJpbmxpbmUiPg0KCQk8cGF0aCBmaWxsPSIjOEY4RjhGIiBkPSJNMjAuOSw0aDEuOGMwLjUsMCwwLjksMC4yLDEuMywwLjVjMC40LDAuMywwLjUsMC43LDAuNSwxLjJ2MTdjMCwwLjUtMC4yLDAuOS0wLjUsMS4yDQoJCQljLTAuNCwwLjMtMC44LDAuNS0xLjMsMC41SDIuNWMtMC41LDAtMC45LTAuMi0xLjMtMC41Yy0wLjQtMC4zLTAuNS0wLjctMC41LTEuMnYtMTdjMC0wLjUsMC4yLTAuOSwwLjUtMS4yQzEuNSw0LjIsMiw0LDIuNSw0aDEuOA0KCQkJIE0yLjUsMjIuOGgyMC4zVjkuMUgyLjVWMjIuOHoiLz4NCgkJPHJlY3QgeD0iNiIgeT0iMTEiIGZpbGw9IiM4RjhGOEYiIHdpZHRoPSIyLjUiIGhlaWdodD0iMi41Ii8+DQoJCTxyZWN0IHg9IjE1LjMiIHk9IjAuNSIgZmlsbD0iIzhGOEY4RiIgd2lkdGg9IjMuOCIgaGVpZ2h0PSI1LjkiLz4NCgkJPHJlY3QgeD0iNi4xIiB5PSIwLjUiIGZpbGw9IiM4RjhGOEYiIHdpZHRoPSIzLjgiIGhlaWdodD0iNS45Ii8+DQoJCTxyZWN0IHg9IjExLjEiIHk9IjExIiBmaWxsPSIjOEY4RjhGIiB3aWR0aD0iMi41IiBoZWlnaHQ9IjIuNSIvPg0KCQk8cmVjdCB4PSIxNi4zIiB5PSIxMSIgZmlsbD0iIzhGOEY4RiIgd2lkdGg9IjIuNSIgaGVpZ2h0PSIyLjUiLz4NCgk8L2c+DQo8L2c+DQo8L3N2Zz4NCg==);\n  background-position:right 6px center;\n  background-repeat:no-repeat;\n  min-height:44px;\n  min-width:32px;\n  background-color:white; }\n.icon-calendar:hover{\n  background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOC4xLjEsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjI1LjNweCINCgkgaGVpZ2h0PSIyNC45cHgiIHZpZXdCb3g9IjAgMCAyNS4zIDI0LjkiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI1LjMgMjQuOSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8ZyBpZD0iY2FsIiBkaXNwbGF5PSJub25lIj4NCgk8ZyBkaXNwbGF5PSJpbmxpbmUiPg0KCQk8cGF0aCBmaWxsPSIjQ0NDQ0NDIiBkPSJNMjAuOSw0aDEuOGMwLjUsMCwwLjksMC4yLDEuMywwLjVjMC40LDAuMywwLjUsMC43LDAuNSwxLjJ2MTdjMCwwLjUtMC4yLDAuOS0wLjUsMS4yDQoJCQljLTAuNCwwLjMtMC44LDAuNS0xLjMsMC41SDIuNWMtMC41LDAtMC45LTAuMi0xLjMtMC41Yy0wLjQtMC4zLTAuNS0wLjctMC41LTEuMnYtMTdjMC0wLjUsMC4yLTAuOSwwLjUtMS4yQzEuNSw0LjIsMiw0LDIuNSw0aDEuOA0KCQkJIE0yLjUsMjIuOGgyMC4zVjkuMUgyLjVWMjIuOHoiLz4NCgkJPHJlY3QgeD0iNiIgeT0iMTEiIGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIyLjUiIGhlaWdodD0iMi41Ii8+DQoJCTxyZWN0IHg9IjE1LjMiIHk9IjAuNSIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjMuOCIgaGVpZ2h0PSI1LjkiLz4NCgkJPHJlY3QgeD0iNi4xIiB5PSIwLjUiIGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIzLjgiIGhlaWdodD0iNS45Ii8+DQoJCTxyZWN0IHg9IjExLjEiIHk9IjExIiBmaWxsPSIjQ0NDQ0NDIiB3aWR0aD0iMi41IiBoZWlnaHQ9IjIuNSIvPg0KCQk8cmVjdCB4PSIxNi4zIiB5PSIxMSIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjIuNSIgaGVpZ2h0PSIyLjUiLz4NCgk8L2c+DQo8L2c+DQo8ZyBpZD0iY2FsLW92ZXIiPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjOEY4RjhGIiBkPSJNMjAuOSw0aDEuOGMwLjUsMCwwLjksMC4yLDEuMywwLjVjMC40LDAuMywwLjUsMC43LDAuNSwxLjJ2MTdjMCwwLjUtMC4yLDAuOS0wLjUsMS4yDQoJCQljLTAuNCwwLjMtMC44LDAuNS0xLjMsMC41SDIuNWMtMC41LDAtMC45LTAuMi0xLjMtMC41Yy0wLjQtMC4zLTAuNS0wLjctMC41LTEuMnYtMTdjMC0wLjUsMC4yLTAuOSwwLjUtMS4yQzEuNSw0LjIsMiw0LDIuNSw0aDEuOA0KCQkJIE0yLjUsMjIuOGgyMC4zVjkuMUgyLjVWMjIuOHoiLz4NCgkJPHJlY3QgeD0iNiIgeT0iMTEiIGZpbGw9IiM4RjhGOEYiIHdpZHRoPSIyLjUiIGhlaWdodD0iMi41Ii8+DQoJCTxyZWN0IHg9IjE1LjMiIHk9IjAuNSIgZmlsbD0iIzhGOEY4RiIgd2lkdGg9IjMuOCIgaGVpZ2h0PSI1LjkiLz4NCgkJPHJlY3QgeD0iNi4xIiB5PSIwLjUiIGZpbGw9IiM4RjhGOEYiIHdpZHRoPSIzLjgiIGhlaWdodD0iNS45Ii8+DQoJCTxyZWN0IHg9IjExLjEiIHk9IjExIiBmaWxsPSIjOEY4RjhGIiB3aWR0aD0iMi41IiBoZWlnaHQ9IjIuNSIvPg0KCQk8cmVjdCB4PSIxNi4zIiB5PSIxMSIgZmlsbD0iIzhGOEY4RiIgd2lkdGg9IjIuNSIgaGVpZ2h0PSIyLjUiLz4NCgk8L2c+DQo8L2c+DQo8L3N2Zz4NCg==);\n  background-position:right 6px center;\n  background-repeat:no-repeat;\n  min-height:44px;\n  min-width:32px;\n  cursor:pointer;\n  background-color:white; }\n.datepicker table tr td.new,\n.datepicker table tr td.old{\n  visibility:hidden; }\n.datepicker table tr td.disabled{\n  color:#C3C3C3; }\n.datepicker th.dow{\n  text-transform:uppercase; }\n.datepicker table{\n  border-collapse:collapse; }\n.datepicker table tr td.day{\n  cursor:pointer; }\n.datepicker table tr td.old.day{\n  border:0; }\n.datepicker table tr td.highlighted{\n  background-color:#F9F9F9; }\n.datepicker table tr td.day.focused{\n  border:1px solid #008E96;\n  background-color:#FFF; }\n.datepicker table tr td.today{\n  background-color:#FFF;\n  background-image:none;\n  border:2px solid #378F7B; }\n.datepicker table tr td.active, .datepicker table tr td.active.active,\n.datepicker table tr td.active:hover:hover{\n  background-image:none; }\n.datepicker th.dow{\n  color:#008E96;\n  font-weight:400; }\n@media (min-width: 768px){\n  .datepicker th.dow{\n    min-width:42px; }\n  .datepicker tbody td, .datepicker tbody th{\n    width:44px;\n    height:44px; } }\n.datepicker tbody td, .datepicker tbody th{\n  border:1px solid #F0EDE9;\n  border-radius:0;\n  background-color:#FFF;\n  text-align:center; }\n.datepicker .next, .datepicker .prev, .datepicker .nextYear, .datepicker .prevYear{\n  color:#e87600;\n  cursor:pointer; }\n@media (max-width: 480px){\n  .datepicker{\n    font-size:12px; } }\n.datepicker-dropdown.datepicker-orient-top:after{\n  bottom:-6px;\n  border-bottom:0;\n  border-top:6px solid #FFF; }\n.datepicker-dropdown.datepicker-orient-top:before{\n  bottom:-7px;\n  border-bottom:0;\n  border-top:7px solid #999; }\n.datepicker-dropdown:after, .datepicker-dropdown:before{\n  content:'';\n  display:inline-block;\n  border-top:0;\n  position:absolute; }\n.datepicker-dropdown.datepicker-orient-bottom:before{\n  top:-7px; }\n.datepicker-dropdown.datepicker-orient-left:before{\n  left:6px; }\n.datepicker-dropdown:before{\n  border-left:7px solid transparent;\n  border-right:7px solid transparent;\n  border-bottom:7px solid rgba(0, 0, 0, 0.15);\n  border-bottom-color:rgba(0, 0, 0, 0.2); }\n.datepicker-dropdown.datepicker-orient-bottom:after{\n  top:-6px; }\n.datepicker-dropdown.datepicker-orient-left:after{\n  left:7px; }\n.datepicker-dropdown:after{\n  border-left:6px solid transparent;\n  border-right:6px solid transparent;\n  border-bottom:6px solid #FFF; }\n.datepicker .next, .datepicker .prev, .datepicker .nextYear, .datepicker .prevYear, .datepicker-switch{\n  text-align:center; }\n.datepicker-days{\n  margin:0 5px; }\ninput#date-picker-input.date-picker-popup-open{\n  border-color:#ccc;\n  background-color:white; }\ninput{\n  font-family:Markoffc;\n  min-height:44px; }\n.datepicker table tr td.active.active,\n.datepicker table tr td.active.highlighted.active,\n.datepicker table tr td.active.highlighted:active,\n.datepicker table tr td.active:active{\n  color:#333;\n  text-shadow:none; }\n.datepicker table tr td.active.highlighted:hover,\n.datepicker table tr td.day:hover,\ntable tr td.active.highlighted{\n  border:2px solid #378F7B; }\n"],
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(function () { return DatePickerComponent; }),
                        multi: true
                    }
                ],
                changeDetection: ChangeDetectionStrategy.OnPush
            },] },
];
DatePickerComponent.ctorParameters = function () { return [
    { type: TranslateService, },
    { type: Logger, },
]; };
DatePickerComponent.propDecorators = {
    "orient": [{ type: Input },],
    "title": [{ type: Input },],
    "lang": [{ type: Input },],
    "format": [{ type: Input },],
    "additionalFormats": [{ type: Input },],
    "min": [{ type: Input },],
    "max": [{ type: Input },],
    "allowInvalid": [{ type: Input },],
    "allowEdit": [{ type: Input },],
    "customClassNames": [{ type: Input },],
    "changed": [{ type: Output },],
    "input": [{ type: ViewChild, args: ['input',] },],
};
var DownloadButtonComponent = /** @class */ (function () {
    function DownloadButtonComponent(window) {
        this.disabled = false;
        this.filename = 'downloaded.txt';
        this.label = 'Download';
        this.download = new EventEmitter();
        this.window = window;
    }
    DownloadButtonComponent.prototype.onDownload = function () {
        this.download.emit();
    };
    DownloadButtonComponent.prototype.save = function (download$) {
        var _this = this;
        return download$.pipe(tap(function (res) {
            var data = new _this.window.Blob([res.response.arrayBuffer()]);
            if (_this.window.navigator.msSaveOrOpenBlob) {
                _this.window.navigator.msSaveOrOpenBlob(data, _this.filename);
            }
            else {
                var url_1 = _this.window.URL.createObjectURL(data);
                _this.downloadAnchor.nativeElement.href = url_1;
                _this.downloadAnchor.nativeElement.click();
                setTimeout(function () { return _this.window.URL.revokeObjectURL(url_1); });
            }
        }));
    };
    return DownloadButtonComponent;
}());
DownloadButtonComponent.decorators = [
    { type: Component, args: [{
                selector: 'fc-download-button',
                template: "<button type=\"button\" class=\"btn secondary\"\n  [disabled]=\"disabled\"\n  (click)=\"onDownload()\"\n>\n  {{ label }}\n  <i class=\"fa fa-download\"></i>\n</button>\n<a #downloadAnchor href=\"\" [download]=\"filename\" hidden ></a>\n"
            },] },
];
DownloadButtonComponent.ctorParameters = function () { return [
    { type: undefined, decorators: [{ type: Inject, args: ['Window',] },] },
]; };
DownloadButtonComponent.propDecorators = {
    "disabled": [{ type: Input },],
    "filename": [{ type: Input },],
    "label": [{ type: Input },],
    "download": [{ type: Output },],
    "downloadAnchor": [{ type: ViewChild, args: ['downloadAnchor',] },],
};
var DownloadMessages = Object.freeze({
    WAIT: 'ACTION.DOWNLOAD.WAIT',
    SUCCESS: 'ACTION.DOWNLOAD.SUCCESS',
    ERROR: 'ACTION.DOWNLOAD.ERROR',
});
var FcDialogComponent = /** @class */ (function () {
    function FcDialogComponent(logger) {
        this.logger = logger;
        this.labelDialog = 'CONFIRMATION_DIALOG.HEADER';
        this.labelSecondaryButton = 'CONFIRMATION_DIALOG.CANCEL';
        this.labelPrimaryButton = 'CONFIRMATION_DIALOG.OK';
        this.buttonClick = new EventEmitter();
        this.enableSecondaryButton = true;
        this.config = {
            backdrop: 'static',
            show: false,
            keyboard: false,
        };
    }
    FcDialogComponent.prototype.show = function () {
        this.logger.debug('Showing confirmation modal');
        this.modal.show();
    };
    FcDialogComponent.prototype.onSecondaryButton = function () {
        this.logger.debug('Secondary button clicked');
        this.buttonClick.emit(true);
        this.modal.hide();
    };
    FcDialogComponent.prototype.onPrimaryButton = function () {
        this.logger.debug('Primary button clicked');
        this.buttonClick.emit(false);
        this.modal.hide();
    };
    FcDialogComponent.prototype.checkTitle = function () {
        return this.titleDialog != null;
    };
    return FcDialogComponent;
}());
FcDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'fc-dialog',
                template: "<div bsModal [config]=\"config\" class=\"modal\" tabindex=\"-1\" role=\"dialog\">\n  <div class=\"modal-dialog fc-dialog modal-sm\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\" *ngIf=\"checkTitle()\">\n        <div class=\"confirmation-dialog-title\"><h4>{{\n          titleDialog | translate\n        }}</h4></div>\n      </div>\n      <div class=\"modal-body\">\n        <p [innerHTML]=\"labelDialog | translate\"></p>\n      </div>\n      <div class=\"modal-footer\">\n        <div class=\"row\">\n          <div class=\"col-xs-12\">\n            <button *ngIf=\"enableSecondaryButton\" id=\"modalSecondaryButton\" type=\"button\" class=\"btn btn-sm secondary\" data-dismiss=\"modal\" (click)=\"onSecondaryButton()\">{{labelSecondaryButton | translate}}</button>\n            <button id=\"modalPrimaryButton\" type=\"button\" class=\"btn btn-sm primary\" (click)=\"onPrimaryButton()\">{{labelPrimaryButton | translate}}</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
                styles: [".fc-dialog{\n  padding-top:5px;\n  padding-bottom:5px;\n  min-height:70px;\n  max-width:450px; }\n  .fc-dialog .modal-header{\n    border-bottom:none;\n    padding:24px;\n    padding-bottom:0; }\n    .fc-dialog .modal-header h4{\n      margin:initial; }\n  .fc-dialog .modal-body{\n    padding:24px;\n    font-size:14px;\n    text-align:initial; }\n    .fc-dialog .modal-body p{\n      margin:0;\n      padding:0; }\n  .fc-dialog .modal-footer{\n    padding:24px;\n    padding-top:0;\n    border-top:none; }\n    .fc-dialog .modal-footer .btn{\n      margin-bottom:0; }\ndiv.fade{\n  -webkit-transition:none !important;\n  transition:none !important; }\n@media (min-width: 768px){\n  .btn.btn-sm.primary, .btn.btn-sm.secondary, .btn.btn-sm.tertiary{\n    min-width:90px;\n    font-size:12px; } }\n"],
            },] },
];
FcDialogComponent.ctorParameters = function () { return [
    { type: Logger, },
]; };
FcDialogComponent.propDecorators = {
    "modal": [{ type: ViewChild, args: [ModalDirective,] },],
    "titleDialog": [{ type: Input },],
    "labelDialog": [{ type: Input },],
    "labelSecondaryButton": [{ type: Input },],
    "labelPrimaryButton": [{ type: Input },],
    "buttonClick": [{ type: Output },],
    "enableSecondaryButton": [{ type: Input },],
};
var PleaseWaitService = /** @class */ (function () {
    function PleaseWaitService() {
        this.messages = [];
        this.change$ = new Subject();
    }
    PleaseWaitService.prototype.add = function (message) {
        if (this.messages.indexOf(message) > -1) {
            return this.messages.length;
        }
        var size = this.messages.push(message);
        this.emit(this.messages);
        return size;
    };
    PleaseWaitService.prototype.remove = function (message) {
        var originalSize = this.messages.length;
        this.messages = this.messages.filter(function (m) { return m !== message; });
        if (originalSize !== this.messages.length)
            this.emit(this.messages);
        return this.messages.length;
    };
    Object.defineProperty(PleaseWaitService.prototype, "messagesChange", {
        get: function () {
            return this.change$.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    PleaseWaitService.prototype.emit = function (messages) {
        var clone = messages.slice(0);
        this.change$.next(clone);
    };
    return PleaseWaitService;
}());
PleaseWaitService.decorators = [
    { type: Injectable },
];
PleaseWaitService.ctorParameters = function () { return []; };
var Toastr = Object.freeze({
    DEFAULT_TTL: 3000,
    INFO_TITLE: 'NOTIFICATIONS.TITLE.INFO',
    SUCCESS_TITLE: 'NOTIFICATIONS.TITLE.SUCCESS',
    WARNING_TITLE: 'NOTIFICATIONS.TITLE.WARNING',
    ERROR_TITLE: 'NOTIFICATIONS.TITLE.ERROR',
    POST_MESSAGE_KEY: 'SHOW_NOTIFICATION',
});
var ToastrService$1 = /** @class */ (function () {
    function ToastrService$1(messageService, logger, translate, ngxToastrService, window) {
        this.messageService = messageService;
        this.logger = logger;
        this.translate = translate;
        this.ngxToastrService = ngxToastrService;
        this.window = window;
        if (this.window.self === this.window.top) {
            this.logger.debug('Toastr strategy: native');
            this.send = this.postNative;
        }
        else {
            this.logger.debug('Toastr strategy: shell');
            this.send = this.postToShell;
        }
    }
    ToastrService$1.prototype.info = function (message, title, timeToLive) {
        var _this = this;
        if (title === void 0) { title = Toastr.INFO_TITLE; }
        if (timeToLive === void 0) { timeToLive = Toastr.DEFAULT_TTL; }
        this.translate.get([title, message])
            .subscribe(function (keys) { return _this.send(keys[message], keys[title], timeToLive, 'info'); });
    };
    ToastrService$1.prototype.success = function (message, title, timeToLive) {
        var _this = this;
        if (title === void 0) { title = Toastr.SUCCESS_TITLE; }
        if (timeToLive === void 0) { timeToLive = Toastr.DEFAULT_TTL; }
        this.translate.get([title, message])
            .subscribe(function (keys) { return _this.send(keys[message], keys[title], timeToLive, 'success'); });
    };
    ToastrService$1.prototype.warning = function (message, title, timeToLive) {
        var _this = this;
        if (title === void 0) { title = Toastr.WARNING_TITLE; }
        if (timeToLive === void 0) { timeToLive = Toastr.DEFAULT_TTL; }
        this.translate.get([title, message])
            .subscribe(function (keys) { return _this.send(keys[message], keys[title], timeToLive, 'warning'); });
    };
    ToastrService$1.prototype.error = function (message, title, timeToLive) {
        var _this = this;
        if (title === void 0) { title = Toastr.ERROR_TITLE; }
        if (timeToLive === void 0) { timeToLive = Toastr.DEFAULT_TTL; }
        this.translate.get([title, message])
            .subscribe(function (keys) { return _this.send(keys[message], keys[title], timeToLive, 'error'); });
    };
    ToastrService$1.prototype.postToShell = function (message, title, timeToLive, severity) {
        this.messageService.post({
            message: Toastr.POST_MESSAGE_KEY,
            content: { message: message, title: title, timeToLive: timeToLive, severity: severity.toUpperCase() },
        });
    };
    ToastrService$1.prototype.postNative = function (message, title, timeOut, severity) {
        this.ngxToastrService[severity](message, title, { timeOut: timeOut });
    };
    return ToastrService$1;
}());
ToastrService$1.decorators = [
    { type: Injectable },
];
ToastrService$1.ctorParameters = function () { return [
    { type: MessageService, },
    { type: Logger, },
    { type: TranslateService, },
    { type: ToastrService, },
    { type: undefined, decorators: [{ type: Inject, args: ['Window',] },] },
]; };
var HttpResponse = /** @class */ (function () {
    function HttpResponse(response, data) {
        this.response = response;
        this.data = data;
    }
    return HttpResponse;
}());
var HttpError = /** @class */ (function (_super) {
    __extends(HttpError, _super);
    function HttpError(message, payload, displayMessage, status) {
        var _this = _super.call(this, message) || this;
        _this.message = message;
        _this.payload = payload;
        _this.displayMessage = displayMessage;
        _this.status = status;
        _this.name = 'HttpError';
        Object.setPrototypeOf(_this, HttpError.prototype);
        return _this;
    }
    return HttpError;
}(Error));
var HttpDisplayMessages = Object.freeze({
    OK: 'ACTION.SUCCESS',
    ERROR: 'ACTION.ERROR',
    401: 'HTTP.STATUS.401',
    403: 'HTTP.STATUS.403',
    404: 'HTTP.STATUS.404',
    500: 'HTTP.STATUS.500',
    503: 'HTTP.STATUS.503',
    504: 'HTTP.STATUS.504',
});
var HttpLogMessages = Object.freeze({
    NOT_A_RESPONSE: 'An HTTP Response is expected',
    WRONG_STATUS: 'Unexpected HTTP status',
    UNEXPECTED: 'An unexpected error occurred',
});
var ErrorObject = /** @class */ (function () {
    function ErrorObject() {
    }
    return ErrorObject;
}());
__decorate([
    deserialize,
    __metadata("design:type", String)
], ErrorObject.prototype, "code", void 0);
__decorate([
    deserialize,
    __metadata("design:type", String)
], ErrorObject.prototype, "source", void 0);
__decorate([
    deserialize,
    __metadata("design:type", Object)
], ErrorObject.prototype, "expects", void 0);
__decorate([
    deserialize,
    __metadata("design:type", String)
], ErrorObject.prototype, "message", void 0);
__decorate([
    deserialize,
    __metadata("design:type", Object)
], ErrorObject.prototype, "details", void 0);
var ErrorResponse = /** @class */ (function () {
    function ErrorResponse() {
    }
    return ErrorResponse;
}());
__decorate([
    deserialize,
    __metadata("design:type", String)
], ErrorResponse.prototype, "reference", void 0);
__decorate([
    deserializeAs(ErrorObject),
    __metadata("design:type", Array)
], ErrorResponse.prototype, "errors", void 0);
__decorate([
    deserializeAs(ErrorObject),
    __metadata("design:type", Array)
], ErrorResponse.prototype, "warnings", void 0);
var CacheableHttpService = /** @class */ (function () {
    function CacheableHttpService(delegate, logger) {
        this.delegate = delegate;
        this.logger = logger;
        this.cache = {};
    }
    CacheableHttpService.prototype.post = function (url, body, options) {
        return this.delegate.post(url, body, options);
    };
    CacheableHttpService.prototype.put = function (url, body, options) {
        return this.delegate.put(url, body, options);
    };
    CacheableHttpService.prototype.delete = function (url, options) {
        return this.delegate.delete(url, options);
    };
    CacheableHttpService.prototype.patch = function (url, body, options) {
        return this.delegate.patch(url, body, options);
    };
    CacheableHttpService.prototype.get = function (url, options, expiresIn, forceRefresh) {
        var _this = this;
        if (options === void 0) { options = {}; }
        if (expiresIn === void 0) { expiresIn = 0; }
        if (forceRefresh === void 0) { forceRefresh = false; }
        return of(this.cache[url]).pipe(mergeMap(function (cache) {
            if (cache && forceRefresh)
                cache.expiresIn = 0;
            if (cache && isEqual(options, cache.options) && !_this.isExpired(cache.expiresIn)) {
                _this.logger.debug('from cache', url);
                return cache.stream;
            }
            else {
                _this.logger.debug('caching', url);
                var stream = _this.delegate.get(url, options).pipe(shareReplay(1));
                if (expiresIn >= 0)
                    expiresIn = expiresIn * 1000 + new Date().getTime();
                _this.cache[url] = { stream: stream, options: options, expiresIn: expiresIn };
                return stream;
            }
        }), tap$1(function () { return _this.clearStaleEntries(); }), catchError(function (error) {
            delete _this.cache[url];
            return _throw(error);
        }));
    };
    CacheableHttpService.prototype.clearStaleEntries = function () {
        var _this = this;
        var oldSize = Object.keys(this.cache).length;
        this.cache = (pickBy(this.cache, function (item) { return !_this.isExpired(item.expiresIn); }));
        var newSize = Object.keys(this.cache).length;
        this.logger.debug(oldSize - newSize + " cache entries removed");
    };
    CacheableHttpService.prototype.isExpired = function (expiresIn) {
        var now = new Date().getTime();
        return expiresIn >= 0 && expiresIn < now;
    };
    return CacheableHttpService;
}());
CacheableHttpService.decorators = [
    { type: Injectable },
];
CacheableHttpService.ctorParameters = function () { return [
    { type: Http, },
    { type: Logger, },
]; };
var HttpService = /** @class */ (function () {
    function HttpService(delegate, window, locale, logger, wait, translate, toastr) {
        var _this = this;
        this.delegate = delegate;
        this.logger = logger;
        this.wait = wait;
        this.translate = translate;
        this.toastr = toastr;
        this.window = window;
        locale.getCurrent().subscribe(function (lang) {
            _this.acceptLanguage = lang.replace('-', '_');
            _this.logger.debug('Default HTTP request options', _this.defaultOptions);
        });
    }
    Object.defineProperty(HttpService.prototype, "defaultHeaders", {
        get: function () {
            return new Headers({
                'Accept': 'application/json',
                'Content-Type': 'application/json; charset=UTF-8',
                'X-MC-FS-Accept-Language': this.acceptLanguage,
                'X-PRDCT-GRP-ID': this.window.sessionStorage.getItem('prdctGrpId'),
                'X-Customer-ID': this.window.sessionStorage.getItem('customerId'),
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HttpService.prototype, "defaultOptions", {
        get: function () {
            return new RequestOptions({ headers: this.defaultHeaders });
        },
        enumerable: true,
        configurable: true
    });
    HttpService.prototype.get = function (request) {
        var url = request.url, expiresIn = request.expiresIn, forceRefresh = request.forceRefresh;
        var options = request.options || this.defaultOptions;
        var response$ = (this.delegate.get(url, options, expiresIn, forceRefresh));
        return this.handle(request, response$);
    };
    HttpService.prototype.post = function (request) {
        var body = this.serialize(request);
        var response$ = this.delegate.post(request.url, body, request.options || this.defaultOptions);
        return this.handle(request, response$);
    };
    HttpService.prototype.put = function (request) {
        var body = this.serialize(request);
        var response$ = this.delegate.put(request.url, body, request.options || this.defaultOptions);
        return this.handle(request, response$);
    };
    HttpService.prototype.delete = function (request) {
        var response$ = (this.delegate.delete(request.url, request.options || this.defaultOptions));
        return this.handle(request, response$);
    };
    HttpService.prototype.patch = function (request) {
        var body = this.serialize(request);
        var response$ = this.delegate.patch(request.url, body, request.options || this.defaultOptions);
        return this.handle(request, response$);
    };
    HttpService.prototype.serialize = function (request) {
        return request.requestType ? Serialize(request.body, request.requestType) : request.body;
    };
    HttpService.prototype.handle = function (request, response$) {
        var _this = this;
        var waitMessage;
        response$ = of(request.waitMessage).pipe(mergeMap(function (message) {
            if (typeof message === 'string') {
                return _this.translate.get(message).pipe(tap$1(function (translated) {
                    waitMessage = translated;
                    _this.logger.debug('adding wait:', translated);
                    _this.wait.add(translated);
                }));
            }
            return of(false);
        }), mergeMapTo(response$));
        return this.handleResponseStatus(request, response$).pipe(map(function (response) { return _this.deserialize(request, response); }), catchError(function (error) { return _this.handleError(request, error); }), mergeMap(function (response) { return _this.handleSuccess(request, response); }), finalize(function () {
            if (waitMessage) {
                _this.logger.debug('removing wait:', waitMessage);
                _this.wait.remove(waitMessage);
            }
        }));
    };
    HttpService.prototype.handleResponseStatus = function (request, response$) {
        var errorMsg = request.toastTokens["ERROR"] || HttpDisplayMessages.ERROR;
        var handle = function (response) {
            if (!(response instanceof Response)) {
                var httpError = new HttpError(HttpLogMessages.NOT_A_RESPONSE, response, errorMsg);
                return _throw(httpError);
            }
            var status = response.status;
            var found = request.responseStatus.some(function (s) { return s === status; });
            if (found)
                return of(response);
            var wrongStatusMessage = request.toastTokens[status] || request.toastTokens["ERROR"]
                || HttpDisplayMessages[status] || HttpDisplayMessages.ERROR;
            var payload;
            try {
                payload = Deserialize(response.json(), ErrorResponse);
                payload.response = response;
                if (!payload.reference) {
                    payload = response;
                }
            }
            catch (e) {
                payload = response;
            }
            var error = new HttpError(HttpLogMessages.WRONG_STATUS, payload, wrongStatusMessage, status);
            return _throw(error);
        };
        return response$.pipe(catchError(handle), mergeMap(handle));
    };
    HttpService.prototype.deserialize = function (request, response) {
        if (request.responseType) {
            var data = Deserialize(response.json(), request.responseType);
            return new HttpResponse(response, data);
        }
        return new HttpResponse(response);
    };
    HttpService.prototype.handleError = function (request, error) {
        var _this = this;
        var result;
        var token = request.toastTokens["ERROR"] || HttpDisplayMessages.ERROR;
        if (error instanceof HttpError) {
            result = error;
        }
        else {
            result = new HttpError(HttpLogMessages.UNEXPECTED, error, token);
        }
        return this.translate.get(result.displayMessage).pipe(mergeMap(function (translated) {
            _this.logger.debug('toasting error:', request.toastOnFailure, translated);
            if (request.toastOnFailure)
                _this.toastr.error(translated);
            return _throw(result);
        }));
    };
    HttpService.prototype.handleSuccess = function (request, response) {
        var _this = this;
        var token = request.toastTokens["OK"] || HttpDisplayMessages.OK;
        this.logger.debug('toasting success:', request.toastOnSuccess, token);
        if (request.toastOnSuccess) {
            return this.translate.get(token).pipe(map(function (translated) {
                _this.toastr.success(translated);
                return response;
            }));
        }
        return of(response);
    };
    return HttpService;
}());
HttpService.decorators = [
    { type: Injectable },
];
HttpService.ctorParameters = function () { return [
    { type: CacheableHttpService, },
    { type: undefined, decorators: [{ type: Inject, args: ['Window',] },] },
    { type: LocaleService, },
    { type: Logger, },
    { type: PleaseWaitService, },
    { type: TranslateService, },
    { type: ToastrService$1, },
]; };
var PleaseWait = Object.freeze({
    DEFAULT_MESSAGE_TOKEN: 'PLEASE_WAIT',
});
var HttpReadRequest = /** @class */ (function () {
    function HttpReadRequest(url, responseType) {
        this.responseStatus = [200, 201, 204];
        this.waitMessage = PleaseWait.DEFAULT_MESSAGE_TOKEN;
        this.toastTokens = HttpDisplayMessages;
        this.toastOnSuccess = true;
        this.toastOnFailure = true;
        this.expiresIn = 0;
        this.forceRefresh = false;
        this.url = url;
        this.responseType = responseType;
    }
    HttpReadRequest.create = function (url, responseType) {
        return new HttpReadRequest(url, responseType);
    };
    HttpReadRequest.prototype.withResponseType = function (responseType) {
        this.responseType = responseType;
        return this;
    };
    HttpReadRequest.prototype.withResponseStatus = function (accepted) {
        var more = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            more[_i - 1] = arguments[_i];
        }
        this.responseStatus = __spread([accepted], more);
        return this;
    };
    HttpReadRequest.prototype.withOptions = function (options) {
        this.options = options;
        return this;
    };
    HttpReadRequest.prototype.withWaitMessage = function (waitMessage) {
        if (waitMessage) {
            this.waitMessage = waitMessage;
        }
        else {
            this.waitMessage = false;
        }
        return this;
    };
    HttpReadRequest.prototype.withToastMessages = function (tokens, onSuccess, onFailure) {
        if (tokens === false) {
            this.toastOnSuccess = this.toastOnFailure = false;
        }
        else {
            this.toastTokens = tokens;
            if (onSuccess !== undefined)
                this.toastOnSuccess = onSuccess;
            if (onFailure !== undefined)
                this.toastOnFailure = onFailure;
        }
        return this;
    };
    HttpReadRequest.prototype.withCache = function (expiresIn, forceRefresh) {
        if (forceRefresh === void 0) { forceRefresh = false; }
        this.expiresIn = expiresIn;
        this.forceRefresh = forceRefresh;
        return this;
    };
    return HttpReadRequest;
}());
var HttpWriteRequest = /** @class */ (function (_super) {
    __extends(HttpWriteRequest, _super);
    function HttpWriteRequest(url, body, requestType, responseType) {
        var _this = _super.call(this, url, responseType) || this;
        _this.body = body;
        _this.requestType = requestType;
        return _this;
    }
    HttpWriteRequest.create = function (url, body, requestType, responseType) {
        return new HttpWriteRequest(url, body, requestType, responseType);
    };
    HttpWriteRequest.prototype.withRequestType = function (requestType) {
        this.requestType = requestType;
        return this;
    };
    return HttpWriteRequest;
}(HttpReadRequest));
var MessageKey = Object.freeze({
    GET_ACCESSIBLE_UI_ACTIONS_QUERY: 'GET_ACCESSIBLE_UI_ACTIONS_QUERY',
    GET_ACCESSIBLE_UI_ACTIONS_RESPONSE: 'GET_ACCESSIBLE_UI_ACTIONS_RESPONSE',
});
var PermissionsService = /** @class */ (function () {
    function PermissionsService(messageService) {
        this.messageService = messageService;
        this.initialized = false;
    }
    PermissionsService.prototype.init = function () {
        if (this.initialized)
            throw new Error('Already initialized');
        this.initialized = true;
        this.stream = this.messageService.get().pipe(filter(function (me) { return me.data.message === MessageKey.GET_ACCESSIBLE_UI_ACTIONS_RESPONSE; }), map(function (me) { return (me.data.content); }), publishReplay(1), refCount());
        this.messageService.post({ message: MessageKey.GET_ACCESSIBLE_UI_ACTIONS_QUERY });
    };
    Object.defineProperty(PermissionsService.prototype, "availableActions", {
        get: function () {
            return this.stream;
        },
        enumerable: true,
        configurable: true
    });
    PermissionsService.prototype.hasActionCode = function (actionCode) {
        return this.availableActions.pipe(map(function (actions) { return actions.some(function (a) { return a.code === actionCode; }); }));
    };
    PermissionsService.prototype.hasSome = function () {
        var actionCodes = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            actionCodes[_i] = arguments[_i];
        }
        return this.availableActions.pipe(map(function (actions) { return actionCodes.some(function (requested) { return actions.find(function (a) { return a.code === requested; }) !== undefined; }); }));
    };
    PermissionsService.prototype.hasEvery = function () {
        var actionCodes = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            actionCodes[_i] = arguments[_i];
        }
        return this.availableActions.pipe(map(function (actions) { return actionCodes.every(function (requested) { return actions.find(function (a) { return a.code === requested; }) !== undefined; }); }));
    };
    return PermissionsService;
}());
PermissionsService.decorators = [
    { type: Injectable },
];
PermissionsService.ctorParameters = function () { return [
    { type: MessageService, },
]; };
var PleaseWaitComponent = /** @class */ (function () {
    function PleaseWaitComponent(service, logger) {
        this.service = service;
        this.logger = logger;
        this.config = {
            backdrop: 'static',
            show: false,
            keyboard: false,
        };
        this.messages = [];
        this.trackByIndex = trackByIndex;
    }
    PleaseWaitComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.service.messagesChange.subscribe(function (newMessages) {
            if (_this.messages.length === 0 && newMessages.length === 1) {
                _this.logger.debug('Showing wait message');
                _this.modal.show();
            }
            if (newMessages.length === 0) {
                _this.logger.debug('Hiding wait message');
                _this.modal.hide();
            }
            _this.messages = newMessages;
        });
    };
    return PleaseWaitComponent;
}());
PleaseWaitComponent.decorators = [
    { type: Component, args: [{
                selector: 'fc-please-wait',
                template: "<div bsModal #pleaseWait=\"bs-modal\" [config]=\"config\"\n     class=\"modal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"pleaseWaitLabel\" aria-hidden=\"true\">\n  <div class=\"modal-dialog please-wait-dialog modal-sm\">\n    <div class=\"modal-content\">\n      <div class=\"modal-body\">\n        <ul class=\"media-list\">\n          <li class=\"media\">\n            <div class=\"media-left\">\n              <img class=\"media-object\" width=\"32px\" src=\"assets/images/wait-blk.gif\" alt=\"\">\n            </div>\n            <div class=\"media-body\">\n              <div class=\"please-wait-heading\">{{'PLEASE_WAIT' | translate }}</div>\n              <div class=\"please-wait-messages\" *ngFor=\"let msg of messages; trackBy: trackByIndex\" >{{ msg }}</div>\n            </div>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n",
                styles: [".please-wait-dialog{\n  padding-top:5px;\n  padding-bottom:5px;\n  min-height:50px;\n  max-width:300px; }\n  .please-wait-dialog .modal-body{\n    padding-top:16px; }\n  .please-wait-dialog .media-body{\n    width:auto;\n    text-align:left; }\n  .please-wait-dialog div.please-wait-heading{\n    font-family:Helvetica, Arial, sans-serif;\n    font-size:16px;\n    font-weight:bold;\n    padding-top:5px; }\n  .please-wait-dialog div.please-wait-messages{\n    font-weight:normal;\n    font-family:Helvetica, Arial, sans-serif;\n    font-size:13px;\n    font-weight:normal;\n    padding-top:3px; }\ndiv.fade{\n  -webkit-transition:none !important;\n  transition:none !important; }\n"],
            },] },
];
PleaseWaitComponent.ctorParameters = function () { return [
    { type: PleaseWaitService, },
    { type: Logger, },
]; };
PleaseWaitComponent.propDecorators = {
    "modal": [{ type: ViewChild, args: [ModalDirective,] },],
};
var MessageKeys = Object.freeze({
    SHOW_CONFIRMATION_DIALOG: 'SHOW_CONFIRMATION_DIALOG',
    CONFIRMATION_DIALOG_OPENED: 'CONFIRMATION_DIALOG_OPENED',
    CONFIRMATION_DIALOG_CLOSED: 'CONFIRMATION_DIALOG_CLOSED',
});
var PreventNavigationService = /** @class */ (function () {
    function PreventNavigationService(messageService, window) {
        this.messageService = messageService;
        this.storage = ((window)).sessionStorage;
    }
    PreventNavigationService.prototype.start = function () {
        var _this = this;
        this.isSafeToQuit = true;
        this.messageService.get().pipe(filter$1(function (incoming) { return incoming.data.message === MessageKeys.CONFIRMATION_DIALOG_OPENED; })).subscribe(function () {
            _this.isSafeToQuit = true;
        });
    };
    Object.defineProperty(PreventNavigationService.prototype, "isSafeToQuit", {
        get: function () {
            return this.storage.getItem('preventNavigation') === '0';
        },
        set: function (safe) {
            var prevent = !safe;
            this.storage.setItem('preventNavigation', String(+prevent));
        },
        enumerable: true,
        configurable: true
    });
    PreventNavigationService.prototype.showConfirmationDialog = function () {
        var message = MessageKeys.SHOW_CONFIRMATION_DIALOG;
        this.isSafeToQuit = true;
        this.messageService.post({ message: message });
    };
    PreventNavigationService.prototype.confirmationDialogClosed = function () {
        return this.messageService.get().pipe(filter$1(function (incoming) { return incoming.data.message === MessageKeys.CONFIRMATION_DIALOG_CLOSED; }), map$1(function (incoming) { return (incoming.data.content.ok); }));
    };
    return PreventNavigationService;
}());
PreventNavigationService.decorators = [
    { type: Injectable },
];
PreventNavigationService.ctorParameters = function () { return [
    { type: MessageService, },
    { type: undefined, decorators: [{ type: Inject, args: ['Window',] },] },
]; };
var bsModules = [
    AccordionModule,
    AlertModule,
    ButtonsModule,
    CarouselModule,
    CollapseModule,
    ModalModule,
    BsDropdownModule,
    PaginationModule,
    ProgressbarModule,
    RatingModule,
    SortableModule,
    TabsModule,
    TimepickerModule,
    TooltipModule,
    TypeaheadModule,
    PopoverModule,
];
function httpFactory(http, window, locale, logger, wait, translate, toastr) {
    return new HttpService(http, window, locale, logger, wait, translate, toastr);
}
function xsrfStrategyFactory() {
    return new CookieXSRFStrategy('TFC-XSRF-Token', 'X-TFC-XSRF-Token');
}
var FraudCenterCommons = /** @class */ (function () {
    function FraudCenterCommons() {
    }
    FraudCenterCommons.forRoot = function () {
        return {
            ngModule: FraudCenterCommons,
            providers: [
                PermissionsService,
                PleaseWaitService,
                ToastrService$1,
                CacheableHttpService,
                PreventNavigationService,
                {
                    provide: HttpService,
                    useFactory: httpFactory,
                    deps: [
                        CacheableHttpService, 'Window', LocaleService, Logger, PleaseWaitService, TranslateService, ToastrService$1
                    ],
                },
                {
                    provide: XSRFStrategy,
                    useFactory: xsrfStrategyFactory
                }
            ],
        };
    };
    return FraudCenterCommons;
}());
FraudCenterCommons.decorators = [
    { type: NgModule, args: [{
                imports: __spread([
                    CommonModule,
                    MastercardCommons
                ], bsModules, [
                    ToastrModule,
                    TranslateModule,
                ]),
                declarations: [
                    PleaseWaitComponent,
                    DatePickerComponent,
                    DownloadButtonComponent,
                    FcDialogComponent
                ],
                exports: [
                    DatePickerComponent,
                    PleaseWaitComponent,
                    ToastrModule,
                    DownloadButtonComponent,
                    FcDialogComponent
                ],
            },] },
];
FraudCenterCommons.ctorParameters = function () { return []; };

export { DatePickerComponent, DownloadButtonComponent, DownloadMessages, FcDialogComponent, HttpService, HttpReadRequest, HttpWriteRequest, HttpResponse, HttpError, HttpDisplayMessages, HttpLogMessages, CacheableHttpService, ErrorObject, ErrorResponse, PermissionsService, PleaseWaitService, PleaseWaitComponent, MessageKeys, PreventNavigationService, ToastrService$1 as ToastrService, httpFactory, xsrfStrategyFactory, FraudCenterCommons };
//# sourceMappingURL=mc-fraud-center-commons.js.map

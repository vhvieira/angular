/*!
 * WalkMe
 * http://www.walkme.com/
 *
 * Copyright 2012, WalkMe ltd
 */
!function(){function e(e,n){var i=o._walkmeExtension;if(i&&i.isLogEnabled&&o.console)try{console.log("WMEC - "+e),t(n)&&console.log(n)}catch(a){}}function t(e){return void 0!==e}function n(){function n(t,n){e("Checking if snippet script exists in page");for(var o=document.getElementsByTagName("script"),d=0;d<o.length;d++){var s=o[d],c=s.getAttribute("id");if(c==t)return e("Found script by id: "+c),a}for(var d=0;d<o.length;d++){var s=o[d],u=s.getAttribute("src");if(p.test(u)||i(s.innerHTML,p))return e("Found script by script src: "+u),a}return e("Didn't find script in page"),r}function i(e,t){return e.length<=h&&t.test(e)}function d(){for(var e,t,n=0;n<g.length;n++)e=g[n],t=document.getElementById(e.id),t?c(e,t):s(e)}function s(e){if(e.startWith&&e.startWith.length>0)for(var t,n,i=document.getElementsByTagName("script"),o=0;o<e.startWith.length;o++){n=e.startWith[o];for(var a=0;a<i.length;a++)if(t=i[a],t.innerHTML.substring(0,n.length)==n)return void c(e,t)}}function c(e,t){e.timeout?setTimeout(function(){t.parentElement.removeChild(t)},0):t.parentElement.removeChild(t)}function u(){for(var e,t=0;t<k.length;t++)if(e=k[t],window[e])try{delete window[e]}catch(n){window[e]=void 0}}var l,m,f=this,p=/.*walkme_[a-fA-F0-9]+(_https)?\.js.*/i,g=[{id:"walkme-extension",timeout:!0},{id:"walkme-extension-properties",timeout:!0,startWith:["window.WalkMe_Extension","window._walkmeExtension"]},{id:"walkme-extension-data",timeout:!1},{id:"walkme-top-url",timeout:!1,startWith:["_walkmeExtension.extTopUrl"]},{id:"walkme-log",timeout:!1,startWith:["_walkmeExtension.isLogEnabled"]},{id:"walkme-should-register",timeout:!1,startWith:["_walkmeExtension.shouldRegister"]},{id:"walkme-extension-settings-loaded",timeout:!1,startWith:["_walkmeExtension.extSettingsLoaded"]},{id:"walkme-load-ext-pre-core",timeout:!1},{id:"walkme-load-ext-core",timeout:!1},{id:"walkme-load-ext-settings",timeout:!1},{id:"walkme-load-snippet",timeout:!1,startWith:["document.dontLoadTriangle","window.document['dontLoadTriangle']"]}],k=["WalkMe_Extension"],w=21,h=350,x="walkme-snippet";f.isSnippetOnSite=function(){return t(m)||(m=o._walkmeInternals||n(x)),!!m},f.getUrl=function(){return document&&document.location?document.location.href:void e("getUrl fucntion couldn't get url from document.location.href")},f.wasSnippetBlocked=function(){if(!o.wmSnippet)return r;var e=o.wmSnippet.getSnippetVersion();if(w>e){var t=document.getElementById("mt_script");return t?!!o._makeTutorial:a}return o._walkmeInternals&&o._walkmeInternals.blocked},f.addScriptToDocument=function(n,i,o,r){t(r)||(r=3),l=l||document.getElementsByTagName("head")[0],l||e("no head...");var d=document.createElement("script");d.async=a,d.src=n,d.id=i,o&&(d.onload=o,d.onreadystatechange=o),r>0&&(d.onerror=function(){f.addScriptToDocument(n,i,o,r-1)}),l.appendChild(d)},f.removeScripts=function(){d(),u()},f.isInIframe=function(){try{return o!=top}catch(e){}return a},f.isCrossDomain=function(){try{if(parent.location.href)return r}catch(e){}return a}}function i(n){function i(){if(o.editorAPI)return void e("Editor is open, stopping extension");var t=o._walkmeExtension;if(!t)return void e("_walkmeExtension Could Not Be Found");var n=t.extSettings;if(!n)return void e("Extension Settings Could Not Be Found");t.shouldRegister&&d(t),document.dontLoadTriangle=a;for(var i=0;i<n.ExtDataFiles.length;i++)c(n.ExtDataFiles[i])}function d(t){try{var n=_(),i={InstallGuid:t.installGuid,ExtensionGuid:t.extensionGuid,Environment:t.currEnvName,OsType:E().name,BrowserName:n.name,BrowserVersion:n.version},o=v[t.currEnvName]+"/Extension/RegisterExtension",a=o+"?extensionEndUserData="+JSON.stringify(i),r=document.createElement("img");r.src=a}catch(d){e(d)}}function s(e){var t=S.substring(e).indexOf(".");return S.substring(e,e+t)}function c(e){return e.Metadata?void u(e.Url):(f.addScriptToDocument(e.Url,"walkme-extension-data"),void(_walkmeExtension.extDataLoaded=l))}function u(e){}function l(n){function i(t){var n=t.Packages;if(!n)return void e("Extension settings has no packages");for(var i=f.getUrl(),o=0;o<n.length;o++)if(I(n[o],i))return m=n[o],void _()}function d(){m.LoadMethod==w.Immediate?v():s(v,!0)}function s(t,n){e("Waiting for original snippet to be blocked"),c(t,n)}function c(t,n){setTimeout(function(){if(f.wasSnippetBlocked()){e("Original snippet has been blocked");var i=o.walkme_post_lib_loaded;i&&(o.walkme_post_lib_loaded=function(){});var a=o._makeTutorial&&_makeTutorial.removeWalkMe;n&&a?(e("Cleanning walkme before loading extension's package (only incase block was in lib)"),_makeTutorial.removeWalkMe(),u(function(){t(i)})):t(i)}else c(t,n)},50)}function u(e){setTimeout(function(){l()?u(e):e()},20)}function l(){return!(!t(o.mtjQuery)&&!t(o.wmjQuery))}function x(t){e("Continue loading original snippet"),o._walkmeInternals&&_walkmeInternals.continueLoad?_walkmeInternals.continueLoad():t?t():o._makeTutorial&&_makeTutorial.Init?_makeTutorial.Init():o.WalkmeSnippet&&WalkmeSnippet()}function v(){f.isInIframe()&&!S()&&(o.walkme_load_in_iframe=a),e("Loading package with snippet: "+m.Snippet),o.document.dontLoadTriangle=r,f.addScriptToDocument(m.Snippet,"walkme-load-snippet")}function S(){return m.LoadOptions==p.OnlyTop}function I(t,n){if(!O(t,n))return r;switch(E(t),t.SnippetDetect){case g.NoSnippetInSite:return t.LoadMethod=w.Immediate,a;case g.SnippetInSite:return t.IsStronger?(t.LoadMethod=T(t)?w.AfterBlock:w.Immediate,a):(e("Package is not stronger"),r);case g.AutoDetect:return f.isSnippetOnSite()?t.IsStronger?(t.LoadMethod=T(t)?w.AfterBlock:w.Immediate,a):(e("Package is not stronger"),r):(t.LoadMethod=w.Immediate,a)}}function E(e){t(e.SnippetDetect)||(e.SnippetDetect=2),t(e.IsSnippetLoading)||(e.IsSnippetLoading=1)}function _(){e("Package is chosen, snippet detect = "+k[m.SnippetDetect]+", load method = "+h[m.LoadMethod])}function T(t){var n=t.IsSnippetLoading&&L();return e("isOriginalSnippetLoading = "+n),n}function L(){var e=f.isInIframe();return!e||e&&!!o.walkme_load_in_iframe}function O(t,n){try{if(e("Checking package : ",t),e("For url : "+n),!t.IsActive)return e("Package is not active"),r;if(-1!=n.indexOf("CDhiddenIframe"))return e("Package not injecting hidden iframe"),r;if(t.IsTestMe&&(e("TestMe mode is on, inejcting walkMeTestMeLoad = true to window"),window.walkMeTestMeLoad=!0),f.isInIframe()&&(!y(t)||!f.isCrossDomain()))return e("Package didn't match iframe options"),r;if(t.IsCheckWindowSize&&!b())return e("Iframe isn't large enough"),r;var i=new RegExp(t.TopRegex,"i");if(!i.test(_walkmeExtension.extTopUrl))return e("Package didn't match top Regex, extTopUrl= "+_walkmeExtension.extTopUrl),r;var o=new RegExp(t.SelfRegex,"i");return o.test(n)?(e("package is valid"),a):(e("Package didn't match self Regex, url= "+n),r)}catch(d){return e(d),r}return r}function b(){var e=0,t=0;return"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth,t=document.body.clientHeight),e>100&&t>100?!0:void 0}function y(e){return e.LoadOptions==p.TopAndCdIframes}i(n),m?d():(document.dontLoadTriangle=r,f.isSnippetOnSite()&&L()?s(x):f.removeScripts(),delete _walkmeExtension.extDataLoaded)}var m,f=n,p={OnlyTop:1,TopAndCdIframes:2},g={NoSnippetInSite:0,SnippetInSite:1,AutoDetect:2},k=["NoSnippetInSite","SnippetInSite","AutoDetect"],w={Immediate:0,AfterBlock:1},h=["Immediate","AfterBlock"],x={Win:"Windows",Mac:"MacOS",Linux:"Linux",X11:"UNIX",Android:"Android",iPad:"iOS",iPod:"iOS",iPhone:"iOS"},v={Production:"https://account.walkme.com",Dev:"https://account.walkmedev.com",QA:"https://account.walkmeqa.com",Local:"http://localhost:51619"},S=o.navigator.userAgent,I=o.document,E=function(){var e;for(var t in x)if(x.hasOwnProperty(t)&&-1!=S.indexOf(t)){e=x[t];break}return e||(e="Unknown"),{name:e}},_=function(){var e,t,n,i;if(-1!=(i=S.indexOf("MSIE")))e="IE",t=s(i+5);else if(-1!=S.indexOf("Trident")&&-1!=(i=S.indexOf("rv:")))e="IE",t=s(i+3);else if(-1!=(i=S.indexOf("Chrome")))e="Chrome",t=S.substring(i+7,S.lastIndexOf(" "));else if(/Firefox\/(\S+)/.test(S))e="Firefox",t=RegExp.$1;else if(i=-1!=S.indexOf("Safari"))e="Safari",/Version\/(\S+)/.test(S)&&(t=RegExp.$1);else if(-1!=(i=S.indexOf("Opera")))if(e="Opera",/Version\/(\S+)/.test(S))t=RegExp.$1;else{var o=Math.max(S.lastIndexOf(" "),S.lastIndexOf("/"));t=S.substring(o+1)}else(n=S.lastIndexOf(" ")+1)<(i=S.lastIndexOf("/"))&&(e=S.substring(n,i),t=S.substring(i+1));return{name:e,version:t,string:e+" "+t,documentMode:I.documentMode}};i()}var o=window,a=!0,r=!1;new i(new n)}();